---
marp: true
theme: default
paginate: true

<!--
npx @marp-team/marp-cli slides.md ./theme/slides.html
-->

---
<!-- header: ![h:5em](https://sasjs.io/img/js-logo700x389.png)-->

# DevOps with SASjs
## Allan Bowe

![bg right:33% height:250 ](https://datacontroller.io/wp-content/uploads/2020/10/abow.png)

---
# The SASjs approach

![bg right:50% height:700](https://sasjs.io/img/git2deploy.png)

---

# Why Choose SASjs?

- Open Source (MIT)
- Cross Platform (Base SAS, SAS 9, Viya)
- Active Development & Support

---

# Why Use SASjs?

- Git-Native SAS Projects
  - compile & build _locally_
  - deploy & execute _remotely_
- Self-Documenting
- Test Driven Development


---
# Where to use SASjs?

- VS Code / local IDE
- Jenkins / scheduling systems
- Bitbucket / Gitlab Pipelines, Github Actions
- GIT Hooks
- Web Apps
- Data Engineering / Data Science projects

---
# SASjs Framework

- [@sasjs/core](https://github.com/sasjs/core) - Macro library
- [@sasjs/adapter](https://github.com/sasjs/adapter) - SAS Server Connectivity
- [@sasjs/cli](https://github.com/sasjs/cli) - CI/CD and Automated Deployment


---
# SASjs Core

- ~150 macros geared towards Application Development
- Functions, Procedures, Metadata, Viya
- `npm install @sasjs/core`

![bg right:50% height:700](https://i.imgur.com/K43rKHb.png)

---
# SASjs Adapter

- Authentication
- Bidirectional communication with SAS
- `npm install @sasjs/adapter`

---
# SASjs CLI

- Opinionated Project Setup
- DevOps
- `npm install --global @sasjs/cli`

---
# SASjs SAS Files

- Primary (deployed)
  - Jobs
  - Services
  - Tests
- Supporting (compiled into Primary)
  - Macros
  - Includes

---
# SASjs Lingo

- AppLoc
  - "App Location"
  - Root folder in SAS Drive or Metadata
- Target
  - "The place you deploy your app"
  - encompasses ALL attributes, eg serverUrl, appLoc, serverType

---
# `sasjs create`

- Prepare a SAS project with an opinionated structure
- Structure is documented within `sasjsconfig.json`
- Templates:
    - `sasjs create myapp -t jobs`
    - `sasjs create myapp -t minimal`
    - `sasjs create myapp -t react`
    - `sasjs create myapp -t angular`

---
# Project Structure

![bg right:71% height:700](https://sasjs.io/img/sasjs-cli-create.png)

---
# `sasjs add`

- Define a Target
- Client / Secret
- App Location (`appLoc`)

![bg right:68% width:870 ](https://i.imgur.com/SaNVk0N.png)

---

# `sasjs run`

- `sasjs run code.sas`

![bg right:60% height:450](https://sasjs.io/img/sasjsrun1.png)

---
# sasjs doc

![bg right:79% ](https://i.imgur.com/mIlgZqh.png)

---
# Data Lineage

![bg right:72% ](https://sasjs.io/img/sasjs-cli-lineage.png)

---
# Doxygen Headers

![bg right:73% ](https://sasjs.io/img/sasjs-cli-doc.png)

---

# sasjsconfig.json

- Project configuration
  - docConfig
  - testConfig
  - jobConfig
  - deployConfig
  - macroFolders
  - ...
- root / target level

![bg right:60% height:800](https://sasjs.io/img/sasjsconfig.png)

---
# `sasjs compile`

- One file per Job / Service / Test
- Init + Term programs
- Macro Variables

![bg right:50% height:650px](https://cli.sasjs.io/img/sasjscompile.png?_=1)

---
# sasjsbuild directory

![bg right:40% height:700px](https://i.imgur.com/r73fl9W.png)

---
# `sasjs build`

- Many files to 1 (or 2)
    - SAS program (SAS 9 + Viya)
        - Generated by default
    - JSON file (Viya only)
        - if `deployServicePack:true`

![bg right:40% height:700px](https://cli.sasjs.io/img/sasjsbuild.png)


---
# `sasjs deploy`

- Loads JSON if `deployServicePack:true` and `serverType:"SASVIYA`
- Executes `deployScripts`:
    - SAS Programs remotely
    - Everything else, locally
- Compile, build & deploy in one step:  `sasjs cbd`

![bg right:50% height:700px](https://sasjs.io/img/sasjs-cli-deploy.png)

---
# Execution

| Command |Description|
|:-------:|:----|
|[job](https://cli.sasjs.io/job)|Manage & Execute SAS Jobs|
|[flow](https://cli.sasjs.io/flow)|SAS job scheduler that takes a JSON file as input, and submit all the jobs sequentially, logging the results to an output CSV file|
|[request](https://cli.sasjs.io/request)|Execute SASjs web services from the commandline|
|[test](https://cli.sasjs.io/test)|Execute SAS unit tests and collect results in json/csv formats together with logs|

---
# `sasjs test`

- filename.test[.integer].sas
- Coverage shown on sasjs compile
- Execute all with `sasjs test`
- Execute some with `sasjs test someFilterString`
- Assertion macros in @sasjs/core
- Click URL to re-run a single test
- JUnit XML support, coming soon

![bg right:50% height:700px](https://user-images.githubusercontent.com/4420615/119498704-92178800-bd6e-11eb-8533-00d96c1642b6.png)

---
# `sasjs lint`

- Catch common coding issues
- Add as git pre-commit hook
- Use in VS Code extension

![bg right:54% height:600px](https://sasjs.io/img/sasjs-cli-lint.png)

---
<!-- header: ![h:3em](https://sasjs.io/img/js-logo700x389.png)-->
# Sample DevOps Workflow

- `git clone` / `git checkout -b branchname`
- make changes
- `sasjs cbd -t myPersonalTarget`
- `sasjs test`
- `git add` / `git commit` - `sasjs lint` runs automatically
- `git push` - backend pipeline builds & runs tests
- PR is reviewed & merged. Backend pipeline deploys and generates docs.
  - `sasjs cbd -t sharedTarget && sasjs doc`

---
<!-- header: ![h:6em](https://sasjs.io/img/js-logo700x389.png)-->
# Other commands

| Command |Description|
|:-------:|:----:|
|[context](https://cli.sasjs.io/context)|List, export, create, edit, and delete SAS Compute contexts|
|[folder](https://cli.sasjs.io/folder)|Management of logical SAS folders|
|[servicepack](/servicepack)|The SASjs Service Pack is a collection of services and folder objects.  The servicepack command lets you deploy them easily|

---
# Coming Soon

- CLI support for remote commands on SAS 9
  - sasjs run / deploy / job execute / request / test
- Desktop (Base) SAS Support for web apps
- Streaming App improvements

---
# Products & Services

- Data Controller for SAS
- Bespoke App Development
- SASjs Framework Support & Extensions

---
<!-- header: ![h:6em](https://sasjs.io/img/js-logo700x389.png)-->

# Allan Bowe, Head of SAS Apps


- https://www.linkedin.com/in/allanbowe/
- allan.bowe@analytium.co.uk
- https://github.com/sasjs

